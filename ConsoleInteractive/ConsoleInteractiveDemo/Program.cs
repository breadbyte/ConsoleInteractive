using System.Threading;
using ConsoleInteractive;
using ConsoleInteractive.Extensions;

namespace ConsoleInteractiveDemo {
    class Program {
        static void Main(string[] args) {
            CancellationTokenSource cts = new();
            ConsoleWriter.Init();
            
            FormattedStringBuilder sb1 = new();
            FormattedStringBuilder sb2 = new();
            FormattedStringBuilder sb3 = new();
            
            //var splitted = "[38;2;12;12;12mHello World!";
            var str = @"[0m[T3] ---[0m[0m[38;2;12;12;12m[T3] Black Text[0m\n[0m[T3] 1 ---[0m[0m[38;2;0;55;218m[T3] Dark Blue Text[0m\n[0m[T3] 2 ---[0m";
            var bigstr = "The size of the map is reduced from (128x128) to (25x25) due to the size limitation of the current terminal.\r\n[48;2;0;113;0m [48;2;0;111;0m [48;2;0;116;0m  [48;2;23;121;10m [48;2;0;111;0m [48;2;7;119;3m [48;2;0;117;0m [48;2;0;108;0m [48;2;0;97;0m [48;2;6;104;3m [48;2;12;108;5m [48;2;0;92;0m [48;2;0;98;0m [48;2;0;101;0m [48;2;0;95;0m [48;2;0;106;0m [48;2;0;108;0m [48;2;0;99;0m [48;2;0;104;0m [48;2;0;116;0m [48;2;0;111;0m [48;2;0;113;0m [48;2;0;111;0m [48;2;6;108;3m [48;2;0;108;0m [48;2;0;106;0m [48;2;0;104;0m [48;2;0;114;0m  [48;2;0;117;0m [48;2;0;118;0m [48;2;7;110;3m [48;2;0;109;0m [48;2;12;113;5m [48;2;6;113;3m [48;2;70;135;31m [48;2;76;136;33m [48;2;35;131;15m [48;2;76;147;34m [48;2;119;166;52m [48;2;91;147;40m [48;2;0;109;0m [48;2;15;117;6m [48;2;39;129;17m [48;2;0;109;0m [48;2;46;129;20m [48;2;39;125;17m [48;2;7;117;3m [48;2;7;116;3m [48;2;50;130;22m [48;2;116;162;51m [0m\r\n[48;2;6;108;3m  [48;2;0;114;0m [48;2;0;112;0m [48;2;12;116;5m [48;2;12;111;5m [48;2;6;107;3m [48;2;12;112;5m [48;2;0;102;0m [48;2;0;107;0m [48;2;0;106;0m [48;2;0;102;0m [48;2;0;100;0m [48;2;0;103;0m [48;2;0;106;0m [48;2;0;103;0m [48;2;0;98;0m [48;2;6;103;3m [48;2;12;113;5m [48;2;6;107;3m [48;2;0;100;0m [48;2;0;103;0m [48;2;0;100;0m [48;2;0;98;0m [48;2;0;104;0m [48;2;0;108;0m [48;2;0;112;0m [48;2;0;116;0m [48;2;0;102;0m [48;2;0;100;0m [48;2;0;103;0m [48;2;0;108;0m [48;2;20;123;9m [48;2;6;111;3m [48;2;0;108;0m [48;2;0;111;0m [48;2;77;142;34m [48;2;77;138;34m [48;2;0;105;0m [48;2;7;111;3m [48;2;109;153;48m  [48;2;83;135;37m [48;2;76;134;33m [48;2;38;123;17m [48;2;0;107;0m [48;2;81;143;36m [48;2;98;152;43m [48;2;42;118;19m [48;2;6;108;3m [48;2;52;133;23m [48;2;116;163;51m [0m\r\n[48;2;26;116;12m [48;2;0;104;0m [48;2;0;106;0m [48;2;0;105;0m [48;2;0;102;0m [48;2;12;108;5m [48;2;18;110;8m [48;2;12;107;5m [48;2;31;120;14m [48;2;12;107;5m [48;2;6;108;3m [48;2;0;116;0m [48;2;0;113;0m [48;2;0;109;0m [48;2;0;99;0m [48;2;20;110;9m [48;2;0;109;0m [48;2;6;117;3m [48;2;0;112;0m [48;2;0;104;0m [48;2;0;96;0m [48;2;0;92;0m [48;2;0;102;0m [48;2;0;106;0m [48;2;48;121;21m [48;2;20;107;9m [48;2;0;101;0m [48;2;0;100;0m [48;2;0;108;0m [48;2;0;112;0m [48;2;14;108;6m [48;2;0;103;0m [48;2;0;111;0m [48;2;0;107;0m [48;2;0;106;0m [48;2;0;104;0m [48;2;54;131;24m [48;2;70;138;31m [48;2;88;142;39m [48;2;78;137;34m [48;2;80;145;35m [48;2;74;144;33m [48;2;0;111;0m [48;2;0;116;0m [48;2;29;123;13m [48;2;84;138;37m [48;2;82;148;36m [48;2;67;142;29m [48;2;86;142;38m [48;2;76;133;33m [48;2;55;128;24m [48;2;0;113;0m [0m\r\n[48;2;0;114;0m [48;2;0;113;0m [48;2;0;104;0m [48;2;0;97;0m [48;2;0;101;0m [48;2;6;108;3m [48;2;0;111;0m [48;2;0;115;0m [48;2;6;112;3m [48;2;26;122;12m [48;2;26;119;12m [48;2;0;106;0m [48;2;0;104;0m  [48;2;0;102;0m [48;2;0;114;0m [48;2;6;97;3m [48;2;6;92;3m [48;2;6;101;3m [48;2;12;105;5m [48;2;0;108;0m [48;2;0;102;0m [48;2;0;103;0m  [48;2;13;108;6m [48;2;7;115;3m [48;2;0;113;0m [48;2;0;112;0m [48;2;0;102;0m [48;2;0;103;0m [48;2;0;107;0m [48;2;0;112;0m [48;2;0;101;0m [48;2;0;98;0m [48;2;0;97;0m [48;2;0;102;0m [48;2;12;106;5m [48;2;0;111;0m [48;2;8;115;4m [48;2;0;109;0m [48;2;0;107;0m [48;2;26;113;12m [48;2;13;110;6m [48;2;0;103;0m [48;2;0;106;0m [48;2;0;111;0m [48;2;19;113;8m [48;2;12;107;5m [48;2;28;120;12m [48;2;22;121;10m [48;2;79;141;35m [48;2;105;147;46m [0m\r\n[48;2;0;105;0m  [48;2;0;103;0m [48;2;0;107;0m [48;2;0;111;0m [48;2;0;112;0m [48;2;0;105;0m [48;2;0;103;0m [48;2;0;109;0m [48;2;0;114;0m [48;2;0;112;0m [48;2;0;107;0m [48;2;0;102;0m  [48;2;12;113;5m [48;2;6;108;3m [48;2;0;116;0m [48;2;0;117;0m [48;2;0;116;0m [48;2;20;122;9m [48;2;6;103;3m [48;2;0;97;0m [48;2;30;111;13m [48;2;18;108;8m [48;2;7;106;3m [48;2;0;101;0m [48;2;0;100;0m [48;2;0;101;0m [48;2;0;108;0m  [48;2;6;112;3m [48;2;0;112;0m [48;2;0;104;0m [48;2;6;105;3m [48;2;57;135;25m [48;2;98;154;43m [48;2;95;150;42m [48;2;87;144;38m [48;2;87;142;38m [48;2;42;124;19m [48;2;6;108;3m [48;2;81;142;36m [48;2;49;124;22m [48;2;32;113;14m [48;2;90;141;40m [48;2;105;147;46m [48;2;12;107;5m [48;2;18;108;8m [48;2;64;131;28m [48;2;0;108;0m [48;2;19;119;8m [48;2;22;122;10m [0m\r\n[48;2;0;95;0m [48;2;0;91;0m [48;2;0;103;0m [48;2;0;104;0m [48;2;0;105;0m [48;2;0;109;0m [48;2;6;106;3m [48;2;0;101;0m [48;2;0;100;0m [48;2;6;103;3m [48;2;46;118;20m [48;2;6;100;3m [48;2;0;106;0m [48;2;0;111;0m [48;2;0;118;0m [48;2;0;111;0m [48;2;0;103;0m [48;2;0;105;0m [48;2;0;106;0m   [48;2;0;107;0m [48;2;13;115;6m [48;2;13;111;6m [48;2;18;107;8m [48;2;0;106;0m [48;2;0;105;0m [48;2;0;103;0m [48;2;12;101;5m [48;2;18;105;8m [48;2;0;102;0m [48;2;0;97;0m [48;2;0;104;0m [48;2;13;108;6m [48;2;32;113;14m [48;2;66;127;29m [48;2;105;147;46m [48;2;35;122;15m [48;2;0;111;0m [48;2;41;121;18m [48;2;69;129;30m [48;2;99;146;44m [48;2;109;153;48m [48;2;58;133;26m [48;2;22;120;10m [48;2;48;128;21m [48;2;38;123;17m [48;2;20;119;9m [48;2;7;113;3m [48;2;0;101;0m [48;2;77;136;34m [48;2;83;138;37m [0m\r\n[48;2;0;106;0m  [48;2;0;103;0m [48;2;0;102;0m [48;2;0;98;0m [48;2;0;103;0m [48;2;0;108;0m [48;2;0;103;0m [48;2;0;98;0m [48;2;12;102;5m [48;2;15;112;6m [48;2;7;108;3m [48;2;0;102;0m [48;2;6;106;3m [48;2;12;107;5m [48;2;0;102;0m [48;2;0;105;0m [48;2;0;102;0m [48;2;0;96;0m [48;2;0;95;0m [48;2;6;108;3m [48;2;0;107;0m [48;2;0;98;0m [48;2;0;100;0m [48;2;0;106;0m [48;2;12;106;5m [48;2;42;112;18m [48;2;62;121;27m [48;2;40;120;17m [48;2;0;102;0m [48;2;0;100;0m [48;2;6;103;3m [48;2;12;106;5m [48;2;7;105;3m [48;2;19;116;8m [48;2;7;119;3m [48;2;19;114;8m [48;2;31;116;14m [48;2;18;117;8m [48;2;53;126;23m [48;2;61;136;27m [48;2;60;134;26m [48;2;86;137;38m [48;2;72;130;32m [48;2;71;125;31m [48;2;83;137;37m [48;2;81;133;35m [48;2;53;118;23m [48;2;61;131;27m [48;2;76;140;33m [48;2;82;140;36m [48;2;109;153;48m [0m\r\n[48;2;0;98;0m [48;2;0;95;0m [48;2;12;108;5m [48;2;0;111;0m [48;2;6;112;3m [48;2;6;108;3m [48;2;19;113;8m [48;2;19;108;8m [48;2;6;105;3m [48;2;18;116;8m [48;2;12;111;5m [48;2;0;103;0m [48;2;6;105;3m [48;2;6;107;3m [48;2;31;108;14m [48;2;18;106;8m [48;2;0;96;0m [48;2;0;104;0m [48;2;18;107;8m [48;2;0;106;0m [48;2;0;104;0m [48;2;0;101;0m [48;2;0;111;0m [48;2;0;113;0m [48;2;6;107;3m [48;2;42;126;19m [48;2;0;116;0m [48;2;0;113;0m [48;2;0;112;0m [48;2;0;111;0m [48;2;0;96;0m [48;2;0;103;0m [48;2;0;108;0m [48;2;0;109;0m [48;2;6;110;3m [48;2;6;107;3m [48;2;35;124;15m [48;2;55;127;24m [48;2;40;120;17m [48;2;25;118;11m [48;2;26;112;12m [48;2;31;112;14m [48;2;87;129;38m [48;2;75;128;33m [48;2;94;139;41m [48;2;85;136;37m [48;2;106;149;47m [48;2;92;145;40m [48;2;0;108;0m [48;2;0;109;0m [48;2;0;111;0m [48;2;0;113;0m [0m\r\n[48;2;38;113;17m [48;2;18;112;8m [48;2;0;100;0m [48;2;6;97;3m [48;2;0;97;0m [48;2;0;102;0m [48;2;12;104;5m [48;2;19;108;8m [48;2;0;102;0m [48;2;0;97;0m [48;2;30;110;13m [48;2;18;103;8m [48;2;0;98;0m [48;2;0;103;0m [48;2;0;112;0m [48;2;0;104;0m [48;2;0;111;0m  [48;2;13;120;6m [48;2;18;118;8m [48;2;26;121;12m [48;2;32;117;14m [48;2;40;115;17m [48;2;26;112;12m [48;2;99;147;43m [48;2;83;138;37m [48;2;28;109;12m [48;2;0;95;0m [48;2;12;101;5m [48;2;6;101;3m [48;2;12;105;5m [48;2;31;108;14m [48;2;57;122;25m [48;2;51;123;23m [48;2;0;108;0m  [48;2;0;109;0m [48;2;28;123;12m [48;2;34;121;15m [48;2;12;108;5m [48;2;42;125;19m [48;2;22;124;10m [48;2;13;121;6m [48;2;31;120;14m [48;2;12;117;5m [48;2;6;118;3m [48;2;34;123;15m [48;2;66;133;29m [48;2;24;117;10m [48;2;40;119;17m [48;2;48;121;21m [48;2;18;110;8m [0m\r\n[48;2;83;137;37m [48;2;40;115;17m [48;2;61;127;27m [48;2;76;135;33m [48;2;12;111;5m [48;2;34;113;15m [48;2;25;110;11m [48;2;0;105;0m [48;2;0;100;0m [48;2;0;98;0m [48;2;12;113;5m [48;2;60;130;26m [48;2;43;115;19m [48;2;46;122;20m [48;2;40;112;17m [48;2;26;110;12m [48;2;13;101;6m [48;2;0;99;0m [48;2;43;118;19m [48;2;63;126;28m [48;2;41;120;18m [48;2;12;113;5m [48;2;6;109;3m [48;2;18;110;8m [48;2;86;145;38m [48;2;65;141;29m [48;2;48;123;21m [48;2;32;113;14m [48;2;83;137;37m [48;2;41;123;18m [48;2;18;113;8m [48;2;53;127;23m [48;2;86;138;38m [48;2;84;131;37m [48;2;56;116;25m [48;2;63;122;28m [48;2;18;103;8m [48;2;18;106;8m [48;2;47;121;21m [48;2;32;115;14m [48;2;32;117;14m [48;2;6;100;3m [48;2;0;100;0m [48;2;12;108;5m [48;2;12;105;5m [48;2;6;103;3m [48;2;44;120;19m [48;2;81;135;35m [48;2;32;113;14m [48;2;34;117;15m [48;2;0;114;0m [48;2;0;117;0m [0m\r\n[48;2;109;153;48m [48;2;106;149;47m [48;2;98;144;43m [48;2;75;133;33m [48;2;40;118;17m [48;2;67;130;30m [48;2;94;139;41m [48;2;38;115;17m [48;2;18;110;8m [48;2;53;122;23m [48;2;79;129;35m [48;2;95;139;42m [48;2;57;130;25m [48;2;46;128;20m [48;2;60;133;26m [48;2;76;137;33m [48;2;7;106;3m [48;2;0;98;0m [48;2;57;134;25m [48;2;46;137;20m [48;2;81;144;36m [48;2;83;135;37m [48;2;12;116;5m [48;2;35;128;15m [48;2;57;130;25m [48;2;0;111;0m [48;2;63;135;28m [48;2;100;149;44m [48;2;77;142;34m [48;2;75;134;33m [48;2;75;132;33m [48;2;100;146;44m [48;2;109;153;48m  [48;2;19;118;8m [48;2;26;120;12m [48;2;40;123;17m [48;2;0;114;0m [48;2;7;118;3m [48;2;13;115;6m [48;2;25;114;11m [48;2;19;113;8m [48;2;0;106;0m [48;2;0;105;0m [48;2;42;124;19m [48;2;0;108;0m [48;2;0;109;0m [48;2;0;110;0m [48;2;105;147;46m [48;2;83;140;37m [48;2;13;104;6m [48;2;0;98;0m [0m\r\n[48;2;48;127;21m [48;2;0;107;0m [48;2;28;120;12m [48;2;76;140;33m [48;2;95;142;42m [48;2;78;132;34m [48;2;0;109;0m [48;2;46;123;20m [48;2;106;149;47m [48;2;109;153;48m [48;2;79;141;35m [48;2;6;112;3m [48;2;6;111;3m [48;2;18;111;8m [48;2;48;124;21m [48;2;102;151;45m [48;2;96;144;42m [48;2;67;130;30m [48;2;0;107;0m [48;2;20;108;9m [48;2;35;123;15m [48;2;22;121;10m [48;2;41;117;18m [48;2;20;111;9m [48;2;30;125;13m [48;2;26;112;12m [48;2;7;109;3m [48;2;22;123;10m [48;2;54;133;24m [48;2;71;140;31m [48;2;79;142;35m [48;2;63;136;28m [48;2;82;137;36m [48;2;101;142;44m [48;2;37;119;16m [48;2;12;111;5m [48;2;0;100;0m [48;2;13;102;6m [48;2;32;112;14m [48;2;26;117;12m [48;2;22;123;10m [48;2;15;118;6m [48;2;0;103;0m [48;2;35;117;15m [48;2;108;151;47m [48;2;77;135;34m [48;2;22;115;10m [48;2;6;113;3m [48;2;23;127;10m [48;2;59;138;26m [48;2;15;115;6m [48;2;0;106;0m [0m\r\n[48;2;0;106;0m [48;2;0;104;0m [48;2;0;108;0m [48;2;0;106;0m [48;2;63;130;28m [48;2;105;147;46m [48;2;0;101;0m [48;2;0;106;0m [48;2;29;123;13m [48;2;64;137;28m [48;2;80;145;35m [48;2;55;136;24m [48;2;92;145;40m [48;2;110;155;49m [48;2;109;153;48m [48;2;108;151;47m [48;2;44;132;19m [48;2;36;129;16m [48;2;18;117;8m [48;2;55;131;24m [48;2;48;128;21m [48;2;18;113;8m [48;2;79;140;35m [48;2;77;135;34m [48;2;69;129;30m [48;2;83;139;37m [48;2;83;138;37m [48;2;60;125;26m [48;2;0;102;0m [48;2;13;110;6m [48;2;32;115;14m [48;2;32;112;14m [48;2;74;125;32m [48;2;90;127;40m [48;2;78;104;31m [48;2;104;59;35m [48;2;117;89;43m [48;2;38;117;16m [48;2;0;108;0m  [48;2;0;103;0m [48;2;0;98;0m [48;2;76;132;33m [48;2;35;121;15m [48;2;22;126;10m [48;2;46;135;20m [48;2;42;121;19m [48;2;6;100;3m [48;2;6;97;3m [48;2;63;127;28m [48;2;0;98;0m [48;2;0;102;0m [0m\r\n[48;2;47;126;21m [48;2;12;110;5m [48;2;0;112;0m [48;2;6;109;3m [48;2;75;134;33m [48;2;104;146;46m [48;2;34;115;15m [48;2;0;101;0m [48;2;18;105;8m [48;2;18;108;8m [48;2;25;112;11m [48;2;32;112;14m [48;2;20;118;9m [48;2;23;124;10m [48;2;44;133;19m [48;2;65;138;29m [48;2;61;124;27m [48;2;44;116;19m [48;2;0;101;0m [48;2;6;110;3m [48;2;77;135;34m [48;2;41;116;18m [48;2;0;111;0m [48;2;28;125;12m [48;2;98;143;44m [48;2;87;134;43m [48;2;0;108;0m [48;2;44;125;19m [48;2;54;123;24m [48;2;54;124;24m [48;2;86;145;38m [48;2;87;147;38m [48;2;102;151;45m [48;2;57;133;25m [48;2;20;121;9m [48;2;36;91;13m [48;2;57;78;19m [48;2;23;106;8m [48;2;6;108;3m [48;2;20;108;9m [48;2;25;114;11m [48;2;0;111;0m [48;2;0;113;0m [48;2;0;112;0m [48;2;0;107;0m [48;2;0;106;0m [48;2;59;135;26m [48;2;83;142;37m [48;2;105;147;46m [48;2;96;144;42m [48;2;83;137;37m [48;2;83;138;37m [0m\r\n[48;2;54;125;24m [48;2;31;112;14m [48;2;40;119;17m [48;2;66;129;29m [48;2;71;141;31m [48;2;71;140;31m [48;2;106;149;47m [48;2;90;142;40m [48;2;65;139;29m [48;2;80;143;35m [48;2;92;145;40m [48;2;36;125;16m [48;2;6;108;3m [48;2;40;120;17m [48;2;20;107;9m [48;2;0;104;0m [48;2;0;111;0m [48;2;36;125;16m [48;2;105;147;46m [48;2;98;145;43m [48;2;82;145;36m [48;2;7;113;3m [48;2;0;113;0m [48;2;6;108;3m [48;2;50;119;23m [48;2;54;123;25m [48;2;0;109;0m [48;2;22;120;10m [48;2;94;148;41m [48;2;57;133;25m [48;2;0;108;0m [48;2;0;109;0m [48;2;40;129;18m [48;2;40;130;18m [48;2;0;116;0m  [48;2;31;100;16m [48;2;21;96;11m [48;2;30;94;15m [48;2;64;120;29m [48;2;6;105;3m [48;2;0;100;0m [48;2;0;102;0m [48;2;0;108;0m [48;2;0;104;0m [48;2;0;106;0m [48;2;0;111;0m [48;2;0;110;0m [48;2;38;115;16m [48;2;110;132;46m [48;2;42;127;19m [48;2;0;113;0m [0m\r\n[48;2;26;122;12m [48;2;12;112;5m [48;2;0;104;0m [48;2;13;115;6m [48;2;26;115;12m [48;2;47;121;21m [48;2;94;148;42m [48;2;93;145;41m [48;2;40;117;17m [48;2;70;134;31m [48;2;36;124;16m [48;2;0;109;0m [48;2;77;139;34m [48;2;48;129;21m [48;2;13;114;6m [48;2;46;119;20m [48;2;61;131;27m [48;2;41;127;18m [48;2;65;140;29m [48;2;103;153;45m [48;2;92;145;40m [48;2;83;138;37m [48;2;40;118;17m [48;2;19;110;8m [48;2;0;108;0m [48;2;41;118;18m [48;2;0;111;0m [48;2;0;116;0m [48;2;29;125;13m [48;2;91;149;40m [48;2;67;134;30m [48;2;72;110;29m [48;2;128;64;44m [48;2;86;86;31m [48;2;28;110;12m [48;2;0;103;0m [48;2;57;105;28m [48;2;118;112;57m [48;2;115;114;55m [48;2;85;131;38m [48;2;34;123;15m [48;2;19;110;8m [48;2;0;97;0m [48;2;0;93;0m [48;2;0;96;0m [48;2;0;100;0m [48;2;0;103;0m  [48;2;79;73;28m [48;2;123;68;44m [48;2;64;130;28m [48;2;40;115;17m [0m\r\n[48;2;47;116;21m [48;2;19;106;8m [48;2;18;106;8m [48;2;38;112;17m [48;2;15;115;6m [48;2;15;118;6m [48;2;83;142;37m [48;2;79;143;35m [48;2;102;151;45m [48;2;111;156;49m [48;2;103;152;45m [48;2;94;145;41m [48;2;113;158;50m [48;2;72;136;32m [48;2;83;135;37m [48;2;35;120;15m [48;2;0;107;0m [48;2;41;116;18m [48;2;47;121;21m [48;2;6;111;3m [48;2;29;120;13m [48;2;70;140;31m [48;2;103;153;45m [48;2;112;158;50m [48;2;58;134;25m [48;2;22;124;10m [48;2;0;114;0m [48;2;0;107;0m [48;2;0;106;0m [48;2;50;138;22m [48;2;56;139;25m [48;2;8;117;4m [48;2;0;114;0m [48;2;13;120;6m [48;2;57;135;25m [48;2;47;126;21m [48;2;110;129;52m [48;2;124;136;58m [48;2;122;117;49m [48;2;93;105;36m [48;2;32;116;14m [48;2;48;125;21m [48;2;53;120;23m [48;2;50;125;22m [48;2;32;121;14m [48;2;12;111;5m [48;2;0;103;0m [48;2;0;105;0m [48;2;15;119;6m [48;2;22;123;10m [48;2;53;138;23m [48;2;94;157;42m [0m\r\n[48;2;35;122;15m [48;2;55;132;24m [48;2;30;130;13m [48;2;16;122;7m [48;2;0;107;0m [48;2;0;106;0m [48;2;15;119;6m [48;2;6;111;3m [48;2;45;125;20m [48;2;83;148;37m [48;2;0;111;0m [48;2;30;124;13m [48;2;106;158;47m [48;2;88;147;39m [48;2;37;130;16m [48;2;19;120;8m [48;2;18;117;8m [48;2;43;131;19m [48;2;113;158;50m [48;2;103;150;45m [48;2;48;121;21m [48;2;18;110;8m [48;2;83;146;37m [48;2;98;154;43m [48;2;24;122;11m [48;2;0;111;0m [48;2;0;106;0m [48;2;51;127;22m [48;2;0;108;0m [48;2;0;107;0m  [48;2;0;108;0m [48;2;0;112;0m [48;2;0;108;0m [48;2;0;105;0m [48;2;34;115;15m [48;2;127;96;64m [48;2;130;94;66m [48;2;35;95;12m [48;2;26;103;9m [48;2;20;122;9m [48;2;19;119;8m [48;2;15;121;6m [48;2;7;116;3m [48;2;0;103;0m [48;2;0;102;0m [48;2;0;98;0m  [48;2;0;106;0m [48;2;0;107;0m [48;2;0;108;0m [48;2;0;109;0m [0m\r\n[48;2;20;113;9m [48;2;32;120;14m [48;2;0;104;0m [48;2;6;109;3m [48;2;46;119;20m [48;2;78;137;34m [48;2;57;131;25m [48;2;42;130;19m [48;2;93;154;41m [48;2;113;166;50m [48;2;112;157;49m [48;2;117;164;52m [48;2;56;139;25m [48;2;24;126;11m [48;2;19;118;8m [48;2;6;114;3m [48;2;0;113;0m [48;2;0;110;0m [48;2;19;116;8m [48;2;7;115;3m [48;2;0;116;0m [48;2;7;120;3m [48;2;63;143;28m [48;2;40;134;18m [48;2;0;111;0m [48;2;0;105;0m [48;2;6;103;3m [48;2;47;126;21m [48;2;12;107;5m [48;2;0;106;0m [48;2;0;107;0m [48;2;28;118;12m [48;2;13;103;6m [48;2;0;96;0m [48;2;6;105;3m [48;2;0;112;0m [48;2;0;113;0m [48;2;6;111;3m [48;2;25;109;11m [48;2;18;103;8m [48;2;40;115;17m [48;2;76;134;33m [48;2;32;114;14m [48;2;18;103;8m [48;2;25;104;11m [48;2;48;120;21m [48;2;0;108;0m [48;2;0;109;0m [48;2;0;108;0m [48;2;0;107;0m [48;2;19;105;8m [48;2;57;119;25m [0m\r\n[48;2;19;109;8m [48;2;40;114;17m [48;2;54;119;24m [48;2;19;109;8m [48;2;0;109;0m [48;2;71;145;31m [48;2;58;129;25m [48;2;13;113;6m [48;2;33;130;14m [48;2;46;134;20m [48;2;37;132;16m [48;2;52;137;23m [48;2;53;136;23m [48;2;60;134;26m [48;2;51;88;17m [48;2;51;86;17m [48;2;43;122;19m [48;2;52;126;23m [48;2;13;115;6m [48;2;14;112;6m [48;2;20;112;9m [48;2;0;106;0m   [48;2;0;113;0m [48;2;6;117;3m [48;2;65;138;29m [48;2;35;126;15m [48;2;0;106;0m [48;2;6;102;3m [48;2;6;103;3m [48;2;41;125;18m [48;2;99;147;44m [48;2;96;144;42m [48;2;83;138;37m [48;2;26;111;12m [48;2;0;111;0m [48;2;0;117;0m [48;2;22;121;10m [48;2;30;125;13m [48;2;129;99;49m [48;2;127;95;48m [48;2;64;136;28m [48;2;7;115;3m [48;2;0;116;0m [48;2;13;116;6m [48;2;0;106;0m [48;2;0;108;0m [48;2;0;102;0m [48;2;19;109;8m [48;2;51;126;23m [48;2;61;136;27m [0m\r\n[48;2;108;151;47m [48;2;87;146;38m [48;2;70;147;31m [48;2;71;147;31m [48;2;49;132;22m [48;2;14;118;6m [48;2;51;132;22m [48;2;69;129;30m [48;2;26;112;12m [48;2;0;103;0m [48;2;0;102;0m [48;2;13;105;6m [48;2;48;121;21m [48;2;45;130;20m [48;2;26;101;9m [48;2;26;102;9m [48;2;100;163;44m [48;2;123;173;54m [48;2;93;150;41m [48;2;71;146;31m [48;2;46;134;20m [48;2;77;143;34m [48;2;94;150;41m [48;2;77;141;34m [48;2;0;103;0m [48;2;0;102;0m  [48;2;0;110;0m  [48;2;6;108;3m [48;2;0;106;0m [48;2;0;105;0m [48;2;15;115;6m [48;2;15;119;6m [48;2;58;135;26m [48;2;15;117;6m [48;2;0;100;0m [48;2;13;101;6m [48;2;60;120;26m [48;2;98;118;46m [48;2;129;81;58m [48;2;109;87;47m [48;2;41;125;18m [48;2;0;101;0m [48;2;0;100;0m [48;2;0;101;0m [48;2;19;108;8m [48;2;0;100;0m [48;2;6;108;3m [48;2;6;107;3m [48;2;0;106;0m  [0m\r\n[48;2;88;149;39m [48;2;29;122;13m [48;2;6;108;3m [48;2;12;111;5m [48;2;0;108;0m [48;2;25;116;11m [48;2;77;139;34m [48;2;103;153;45m [48;2;108;151;47m [48;2;98;143;43m [48;2;98;138;43m [48;2;96;134;42m [48;2;41;128;18m [48;2;15;115;6m [48;2;0;98;0m [48;2;20;107;9m [48;2;54;131;24m [48;2;76;148;34m [48;2;8;118;4m [48;2;0;116;0m [48;2;0;113;0m [48;2;14;116;6m [48;2;0;111;0m [48;2;0;113;0m [48;2;0;114;0m [48;2;20;121;9m [48;2;14;118;6m [48;2;14;98;5m [48;2;86;61;29m [48;2;95;119;39m [48;2;54;125;24m [48;2;75;134;33m [48;2;13;115;6m [48;2;0;114;0m [48;2;7;109;3m [48;2;6;103;3m [48;2;0;109;0m [48;2;15;118;6m [48;2;75;144;33m [48;2;95;122;46m [48;2;78;105;40m [48;2;58;107;29m [48;2;6;112;3m [48;2;0;114;0m [48;2;0;116;0m [48;2;0;113;0m [48;2;15;122;6m [48;2;0;116;0m [48;2;0;107;0m [48;2;0;105;0m [48;2;0;97;0m [48;2;0;98;0m [0m\r\n[48;2;0;116;0m [48;2;0;114;0m [48;2;0;113;0m [48;2;0;112;0m [48;2;0;111;0m [48;2;0;112;0m [48;2;20;121;9m [48;2;28;126;12m [48;2;57;138;25m [48;2;87;147;38m [48;2;116;163;51m [48;2;115;161;51m [48;2;6;107;3m [48;2;0;106;0m [48;2;0;113;0m [48;2;17;124;7m [48;2;0;113;0m [48;2;0;111;0m [48;2;0;108;0m [48;2;29;113;13m [48;2;43;123;19m [48;2;52;135;23m [48;2;6;114;3m [48;2;14;112;6m [48;2;34;110;15m [48;2;13;103;6m [48;2;0;102;0m [48;2;20;111;9m [48;2;12;110;5m [48;2;13;114;6m [48;2;53;127;23m [48;2;13;118;6m [48;2;0;113;0m [48;2;0;106;0m [48;2;42;119;18m [48;2;58;131;25m [48;2;0;107;0m [48;2;0;110;0m [48;2;0;113;0m  [48;2;0;107;0m [48;2;0;105;0m [48;2;41;118;18m [48;2;32;110;14m [48;2;40;114;17m [48;2;47;119;21m [48;2;6;98;3m [48;2;0;97;0m [48;2;0;105;0m [48;2;12;110;5m [48;2;0;106;0m  [0m\r\n[48;2;14;111;6m [48;2;0;108;0m [48;2;0;114;0m  [48;2;0;111;0m [48;2;0;110;0m [48;2;0;114;0m [48;2;0;113;0m [48;2;0;109;0m  [48;2;83;154;37m [48;2;125;175;55m [48;2;95;156;42m [48;2;86;147;38m [48;2;13;109;6m [48;2;0;102;0m [48;2;0;107;0m [48;2;0;112;0m [48;2;6;112;3m [48;2;14;117;6m [48;2;0;108;0m [48;2;0;101;0m [48;2;0;100;0m [48;2;71;134;31m [48;2;98;145;43m [48;2;93;138;41m [48;2;97;136;43m [48;2;109;153;48m [48;2;14;117;6m [48;2;13;121;6m [48;2;84;149;37m [48;2;29;118;13m [48;2;0;113;0m  [48;2;53;137;23m [48;2;77;145;34m [48;2;0;108;0m   [48;2;0;106;0m [48;2;0;108;0m [48;2;6;113;3m [48;2;7;119;3m [48;2;22;124;10m [48;2;34;130;15m [48;2;58;139;26m [48;2;55;130;24m [48;2;25;108;11m [48;2;0;107;0m [48;2;0;109;0m [48;2;0;111;0m [48;2;0;109;0m [0m\r\n[48;2;20;123;9m [48;2;6;114;3m [48;2;0;102;0m [48;2;0;104;0m [48;2;45;126;20m [48;2;80;143;35m [48;2;26;111;12m [48;2;18;106;8m [48;2;6;103;3m [48;2;20;113;9m [48;2;74;152;32m [48;2;109;169;48m [48;2;102;159;45m [48;2;46;132;20m [48;2;0;116;0m [48;2;0;114;0m [48;2;0;113;0m  [48;2;43;124;19m [48;2;48;126;21m [48;2;25;109;11m [48;2;19;109;8m [48;2;46;124;20m [48;2;77;131;34m [48;2;65;127;28m [48;2;0;111;0m [48;2;14;116;6m [48;2;30;126;13m [48;2;6;113;3m [48;2;0;110;0m  [48;2;13;114;6m [48;2;24;112;24m [48;2;0;102;0m [48;2;8;111;4m [48;2;17;123;7m [48;2;0;113;0m  [48;2;0;107;0m [48;2;0;106;0m [48;2;0;108;0m [48;2;0;107;0m [48;2;0;101;0m [48;2;0;105;0m [48;2;0;114;0m [48;2;0;116;0m  [48;2;0;114;0m [48;2;32;117;14m [48;2;12;107;5m [48;2;6;101;3m [48;2;18;106;8m [0m\r\n[48;2;0;100;0m [48;2;0;112;0m [48;2;19;119;8m [48;2;7;109;3m [48;2;0;107;0m [48;2;59;144;26m [48;2;51;146;22m [48;2;76;156;34m [48;2;39;126;17m [48;2;0;110;0m  [48;2;38;125;17m [48;2;99;147;44m [48;2;64;131;28m [48;2;0;95;0m [48;2;0;98;0m [48;2;0;97;0m [48;2;18;102;8m [48;2;69;139;30m [48;2;36;124;36m [48;2;36;119;16m [48;2;87;151;67m [48;2;0;98;0m [48;2;63;132;28m [48;2;108;151;47m [48;2;35;126;15m [48;2;0;109;0m [48;2;95;154;95m [48;2;102;162;102m [48;2;101;147;101m [48;2;131;162;131m [48;2;15;113;15m [48;2;234;234;234m [48;2;201;201;201m [48;2;72;134;72m [48;2;0;100;0m [48;2;0;97;0m [48;2;0;100;0m [48;2;0;96;0m [48;2;41;120;18m [48;2;53;115;23m [48;2;53;114;23m [48;2;101;148;45m [48;2;88;143;39m [48;2;0;93;0m [48;2;0;98;0m [48;2;0;103;0m [48;2;0;117;0m [48;2;0;113;0m [48;2;0;110;0m [48;2;0;113;0m [48;2;0;120;0m [0m";
            var str3 = "This is a test string";
            // todo: breaks with space in the 0m - verify
            var str4 = "[48;2;231;72;86m [0m<win11-test> gafgffdfh";
            var str5 = "text [0mwithout [0mmatch aaaaaaa [0m§aText §n§cwith §m§bMixed [0m§1C§2o§3l§r§4o§5r§6s§a!";
            var mkup = ConsoleInteractive.Convert.FromMarkup(str5);
            FormattedStringBuilder fsb = new();
            fsb.strings = mkup;
            sb1.AppendTerminalCode(str4);
            sb2.AppendTerminalCode(str);
            sb3.AppendTerminalCode(str5);
            ConsoleWriter.WriteLine(fsb);
            ConsoleWriter.WriteLine(sb1);
            ConsoleWriter.WriteLine(str);
            ConsoleWriter.WriteLine(str5);
            Debugger.Break();

            //sb.AppendTerminalCode(bigstr);
            
            /*sb.AppendLine("[T3] ---")
              .AppendLine("[T3] Black Text", Color.Black)
              .AppendLine("[T3] 1 ---")
              .AppendLine("[T3] Dark Blue Text", Color.DarkBlue)
              .AppendLine("[T3] 2 ---")
              .AppendLine("[T3] Dark Green Text", Color.DarkGreen)
              .AppendLine("[T3] 3 ---")
              .AppendLine("[T3] Dark Aqua Text", Color.DarkCyan)
              .AppendLine("[T3] 4 ---")
              .AppendLine("[T3] Dark Red Text", Color.DarkRed)
              .AppendLine("[T3] 5 ---")
              .AppendLine("[T3] Dark Purple Text", Color.DarkMagenta);
              .AppendLine("[T3] 6 ---")
              .AppendLine("[T3] Gold Text", Color.Yellow)
              .AppendLine("[T3] 7 ---")
              .AppendLine("[T3] Gray Text", Color.Gray)
              .AppendLine("[T3] 8 ---")
              .AppendLine("[T3] Dark Gray Text", Color.DarkGray)
              .AppendLine("[T3] 9 ---")
              .AppendLine("[T3] Blue Text", Color.Blue)
              .AppendLine("[T3] a ---")
              .AppendLine("[T3] Green Text", Color.Green)
              .AppendLine("[T3] b ---")
              .AppendLine("[T3] Aqua Text", Color.Cyan)
              .AppendLine("[T3] c ---")
              .AppendLine("[T3] Red Text", Color.Red)
              .AppendLine("[T3] d ---")
              .AppendLine("[T3] Light Purple Text", Color.Magenta)
              .AppendLine("[T3] e ---")
              .AppendLine("[T3] Yellow Text", Color.Yellow)
              .AppendLine("[T3] f ---")
              .AppendLine("[T3] White Text", Color.White)
              .AppendLine("[T3] k ---")
              .Append("[T3] ")
              .Append("Obfuscated Text", formatting: Formatting.Obfuscated)
              .AppendLine(" (Obfuscated)")
              .AppendLine("[T3] l ---")
              .Append("[T3] ")
              .AppendLine("Bold Text", formatting: Formatting.Bold)
              .AppendLine("[T3] m ---")
              .Append("[T3] ")
              .AppendLine("Strikethrough Text", formatting: Formatting.Strikethrough)
              .AppendLine("[T3] n ---")
              .Append("[T3] ")
              .AppendLine("Underline Text", formatting: Formatting.Underline)
              .AppendLine("[T3] o ---")
              .Append("[T3] ")
              .AppendLine("Italic Text", formatting: Formatting.Italic);*/
              //.AppendLine("This text \n has an n newline and \r\n an rn newline!");
            //var expanded = sb.Expand();
            //var built = sb2.Flatten();
            //var splits = built.SplitNewLines();
            //foreach (var split in splits) {
            //    f.AppendTerminalCodeMarkup(split);
            //}
            //Debugger.Break();
            //ConsoleWriter.ForceUseWindowsAPI();
            //ConsoleWriter.WriteLine(str);
            //ConsoleWriter.WriteLine(sb);
            //ConsoleWriter.WriteLine(sb);
            //Debugger.Break();
            CancellationTokenSource cts = new CancellationTokenSource();
            
            ConsoleWriter.WriteLine("Waiting for debugger...");
            //while (!Debugger.IsAttached) {
            //    Thread.Sleep(100);
            //}
            //Debugger.Break();

            ConsoleWriter.WriteLine("type cancel to exit the application.");
            var t1 = new Thread(new ThreadStart(() => {
                ConsoleWriter.WriteLine("[T1] Hello World!");
                Thread.Sleep(5000);
                ConsoleWriter.WriteLine("[T1] Hello World after 5 seconds!");
                Thread.Sleep(3000);
                ConsoleWriter.WriteLine("[T1] Hello World after 8 seconds!");
                Thread.Sleep(3000);
                ConsoleWriter.WriteLine("[T1] Hello World after 11 seconds!");
                Thread.Sleep(5000);
                ConsoleWriter.WriteLine("[T1] Hello World after 16 seconds!");
            })) {IsBackground = true};
            var t2 = new Thread(new ThreadStart(() => {
                ConsoleWriter.WriteLine("[T2] Hello from Thread 2!");
                Thread.Sleep(3000);
                ConsoleWriter.WriteLine("[T2] Hello from Thread 2 after 3 seconds!");
                Thread.Sleep(1000);
                ConsoleWriter.WriteLine("[T2] Hello from Thread 2 after 4 seconds!");
                Thread.Sleep(2000);
                ConsoleWriter.WriteLine("[T2] Hello from Thread 2 after 6 seconds!");
                Thread.Sleep(4000);
                ConsoleWriter.WriteLine("[T2] Hello from Thread 2 after 10 seconds!");
                Thread.Sleep(1000);
                ConsoleWriter.WriteLine("[T2] 1 Filler...");
                ConsoleWriter.WriteLine("[T2] 2 Filler...");
                ConsoleWriter.WriteLine("[T2] 3 Filler...");
                ConsoleWriter.WriteLine("[T2] 4 Filler...");
                ConsoleWriter.WriteLine("[T2] 5 Filler...");
                ConsoleWriter.WriteLine("[T2] 6 Filler...");
                ConsoleWriter.WriteLine("[T2] 7 Filler...");
            })) {IsBackground = true};

            var tF = new Thread(new ThreadStart(() => {
                Debugger.Break();
                //ConsoleWriter.WriteLine(f);
                ConsoleWriter.WriteLine(sb2);
            })) {IsBackground = true};
            
            t1.Start();
            t2.Start();
            tF.Start();
            
            ConsoleReader.BeginReadThread();
            ConsoleReader.MessageReceived += (sender, s) => {
                if (s.Equals("cancel"))
                    ConsoleReader.StopReadThread();
                else {
                    ConsoleWriter.WriteLine(s);
                }
            };
            
            tF.Start();
        }
    }
}